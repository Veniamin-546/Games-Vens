<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Colony Z - Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --main-color: #00f2ff; 
            --star-color: #ffaa00; 
            --bg-color: #0a0a0c; 
            --card-bg: #161618;
        }
        
        body { 
            background: var(--bg-color); 
            color: white; 
            font-family: 'Inter', -apple-system, sans-serif; 
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            user-select: none;
        }

        /* –®–∞–ø–∫–∞ */
        .header { padding: 25px 20px; text-align: center; flex-shrink: 0; }
        .amount { font-size: 48px; font-weight: 900; color: var(--main-color); text-shadow: 0 0 20px rgba(0,242,255,0.3); }
        .income { color: #888; font-size: 14px; margin-top: 5px; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .tab-content { 
            flex-grow: 1; 
            display: none; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            overflow-y: auto; 
            padding-bottom: 100px;
        }
        .tab-content.active { display: flex; }

        /* –ò–≥—Ä–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ */
        .main-btn { 
            width: 240px; 
            height: 240px; 
            border-radius: 50%; 
            border: 8px solid #1a1a1a; 
            background: radial-gradient(circle, #222 0%, #000 100%); 
            box-shadow: 0 0 40px rgba(0,242,255,0.1); 
            cursor: pointer; 
            font-size: 90px; 
            transition: transform 0.05s ease; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        .main-btn:active { transform: scale(0.92); border-color: var(--main-color); }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop-list { width: 100%; max-width: 400px; }
        .card { 
            background: var(--card-bg); 
            border: 1px solid #282828; 
            padding: 16px; 
            border-radius: 20px; 
            margin-bottom: 12px;
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .card.star { border: 1px solid rgba(255, 170, 0, 0.3); background: rgba(255, 170, 0, 0.02); }
        .card-info b { display: block; font-size: 16px; margin-bottom: 4px; }
        .card-info span { font-size: 12px; color: #777; }

        .btn-buy { 
            background: var(--main-color); 
            color: #000; 
            border: none; 
            padding: 10px 18px; 
            border-radius: 12px; 
            font-weight: 800; 
            cursor: pointer;
        }
        .btn-buy.star { background: var(--star-color); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { 
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%);
            width: 90%; 
            background: rgba(20, 20, 22, 0.95); 
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            border-radius: 25px; 
            display: flex; 
            padding: 8px; 
            justify-content: space-around;
            z-index: 1000;
        }
        .nav-item { 
            padding: 10px 20px; 
            border-radius: 18px; 
            text-align: center; 
            color: #666; 
            font-size: 12px; 
            cursor: pointer;
            transition: 0.3s;
        }
        .nav-item.active { background: #222; color: var(--main-color); }
        .nav-item i { display: block; font-size: 20px; font-style: normal; margin-bottom: 4px; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞ */
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="amount" id="balance">0</div>
        <div class="income" id="income-display">–ü—Ä–∏–±—ã–ª—å: +1</div>
    </div>

    <div id="game" class="tab-content active">
        <div id="lvl-badge" style="color: var(--main-color); font-weight: bold; margin-bottom: 20px;">–£–†–û–í–ï–ù–¨ 1</div>
        <button class="main-btn" id="rocket-btn" onclick="handleMine(event)">üöÄ</button>
    </div>

    <div id="shop" class="tab-content">
        <h2 style="width: 100%; margin-bottom: 20px;">–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
        <div class="shop-list">
            <div class="card">
                <div class="card-info">
                    <b>–ú–æ—â–Ω—ã–π –∫–ª–∏–∫</b>
                    <span>–î–æ–±–∞–≤–ª—è–µ—Ç +1 –∫ —Å–∏–ª–µ –∫–ª–∏–∫–∞</span>
                </div>
                <button class="btn-buy" id="upgrade-cost" onclick="buyUpgrade()">50 üí∞</button>
            </div>

            <div class="card star">
                <div class="card-info">
                    <b style="color: var(--star-color);">ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</b>
                    <span>10 –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫. / 10 –º–∏–Ω—É—Ç</span>
                </div>
                <button class="btn-buy star" onclick="requestStarsPayment('autoclicker_10')">100 ‚≠ê</button>
            </div>

            <div class="card star">
                <div class="card-info">
                    <b style="color: var(--star-color);">‚ö° –°—É–ø–µ—Ä –º–Ω–æ–∂–∏—Ç–µ–ª—å</b>
                    <span>–£–¥–≤–∞–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –Ω–∞–≤—Å–µ–≥–¥–∞</span>
                </div>
                <button class="btn-buy star" onclick="requestStarsPayment('multiplier_x2')">250 ‚≠ê</button>
            </div>
        </div>
    </div>

    <div id="top" class="tab-content">
        <h2>–õ–∏–¥–µ—Ä—ã –∫–æ–ª–æ–Ω–∏–∏</h2>
        <p style="color: #555;">–†–µ–π—Ç–∏–Ω–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–∞–∑ –≤ —á–∞—Å...</p>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="switchTab('game', this)"><i>üöÄ</i>–ò–≥—Ä–∞</div>
        <div class="nav-item" onclick="switchTab('shop', this)"><i>‚≠ê</i>–ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="nav-item" onclick="switchTab('top', this)"><i>üèÜ</i>–¢–æ–ø</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let state = {
            coins: Number(localStorage.getItem('coins')) || 0,
            power: Number(localStorage.getItem('power')) || 1,
            price: Number(localStorage.getItem('price')) || 50,
            mult: Number(localStorage.getItem('mult')) || 1
        };

        function updateDisplay() {
            document.getElementById('balance').innerText = Math.floor(state.coins).toLocaleString();
            document.getElementById('income-display').innerText = `–ü—Ä–∏–±—ã–ª—å: +${state.power * state.mult}`;
            document.getElementById('upgrade-cost').innerText = `${state.price} üí∞`;
            
            // –°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è
            const rocket = document.getElementById('rocket-btn');
            const badge = document.getElementById('lvl-badge');
            if (state.power >= 50) { rocket.innerText = 'üõ∏'; badge.innerText = '–£–†–û–í–ï–ù–¨: –ì–ê–õ–ê–ö–¢–ò–ö–ê'; }
            else if (state.power >= 20) { rocket.innerText = 'üõ∞Ô∏è'; badge.innerText = '–£–†–û–í–ï–ù–¨: –û–†–ë–ò–¢–ê'; }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            localStorage.setItem('coins', state.coins);
            localStorage.setItem('power', state.power);
            localStorage.setItem('price', state.price);
            localStorage.setItem('mult', state.mult);
        }

        function handleMine(e) {
            state.coins += (state.power * state.mult);
            tg.HapticFeedback.impactOccurred('medium');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–ª–∞
            const x = e.clientX || window.innerWidth / 2;
            const y = e.clientY || window.innerHeight / 2;
            const anim = document.createElement('div');
            anim.innerText = `+${state.power * state.mult}`;
            anim.style.cssText = `position:fixed; left:${x}px; top:${y}px; color:var(--main-color); font-weight:900; pointer-events:none; animation: floatUp 0.6s ease-out forwards; z-index:9999;`;
            document.body.appendChild(anim);
            setTimeout(() => anim.remove(), 600);

            updateDisplay();
        }

        function switchTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        function buyUpgrade() {
            if (state.coins >= state.price) {
                state.coins -= state.price;
                state.power += 1;
                state.price = Math.floor(state.price * 1.5);
                tg.HapticFeedback.notificationOccurred('success');
                updateDisplay();
            } else {
                tg.showAlert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞! –ö–ª–∏–∫–∞–π –∞–∫—Ç–∏–≤–Ω–µ–µ üöÄ");
            }
        }

        // –ü–û–ö–£–ü–ö–ê –ó–ê –ó–í–ï–ó–î–´
        function requestStarsPayment(itemId) {
            tg.showConfirm(`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å —ç—Ç–æ—Ç –±–æ–Ω—É—Å –∑–∞ –ó–≤–µ–∑–¥—ã?`, (ok) => {
                if (ok) {
                    // –≠—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å. –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É JSON-—Å—Ç—Ä–æ–∫—É.
                    // –¢–≤–æ–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ Python –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç –ø–æ–π–º–∞—Ç—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç.
                    tg.sendData(JSON.stringify({
                        method: "payment",
                        item: itemId
                    }));
                }
            });
        }

        updateDisplay();
    </script>
</body>
</html>
